#+TITLE: WRF scaling and timing on Cheyenne
#+AUTHOR: Akira Kyle
#+EMAIL: akyle@cmu.edu
#+OPTIONS: toc:nil email:t

#+BEGIN_SRC ipython :session :exports code
import numpy as np
import matplotlib.pyplot as plt
%matplotlib inline
%config InlineBackend.figure_format = 'svg'
#+END_SRC

#+RESULTS:
: # Out[68]:

* CONUS 12km

#+begin_src bash :dir /ssh:cheyenne:~/work/results/conus12km-WRFV3.8.1 :results raw
wrf_stats -t -H -w 55 -d conus12km-WRFV3.8.1-*
#+end_src

#+NAME: wrf-stats
#+RESULTS:
| File                                                    | Comp: Total(s) | Steps | Avg.(s/step) |      Speed | I/O: Total(s) | Avg.(s/step) |   XxY | CPUs |
|---------------------------------------------------------+----------------+-------+--------------+------------+---------------+--------------+-------+------|
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N001/rsl.out.00 |      116.21725 |   149 |      0.77998 |   92.30988 |       9.98891 |      4.99446 |   6x6 |   36 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N002/rsl.out.00 |       58.23755 |   149 |      0.39086 |  184.21105 |      10.15777 |      5.07888 |   8x9 |   72 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N004/rsl.out.00 |       30.40925 |   149 |      0.20409 |  352.78739 |      11.43522 |      5.71761 | 12x12 |  144 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N008/rsl.out.00 |       15.25841 |   149 |      0.10241 |  703.08767 |      11.96531 |      5.98265 | 16x18 |  288 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N016/rsl.out.00 |        8.55777 |   149 |      0.05743 | 1253.59761 |      12.26190 |      6.13095 | 24x24 |  576 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N032/rsl.out.00 |        4.97061 |   149 |      0.03336 | 2158.28641 |      12.15401 |      6.07700 | 32x36 | 1152 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N064/rsl.out.00 |        3.25526 |   149 |      0.02185 | 3295.58929 |      12.54158 |      6.27079 | 48x48 | 2304 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N128/rsl.out.00 |        2.18854 |   149 |      0.01469 | 4901.89807 |      13.33244 |      6.66622 | 64x72 | 4608 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N256/rsl.out.00 |        1.77643 |   149 |      0.01192 | 6039.07838 |      15.75393 |      7.87697 | 96x96 | 9216 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T2-N001/rsl.out.00 |      116.09852 |   149 |      0.77918 |   92.40428 |      10.05604 |      5.02802 |   6x6 |   36 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T2-N002/rsl.out.00 |       58.21806 |   149 |      0.39073 |  184.27272 |       9.92726 |      4.96363 |   8x9 |   72 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T2-N004/rsl.out.00 |       29.07231 |   149 |      0.19512 |  369.01092 |      11.48687 |      5.74343 | 12x12 |  144 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T2-N008/rsl.out.00 |       15.33797 |   149 |      0.10294 |  699.44067 |      12.03111 |      6.01555 | 16x18 |  288 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T2-N016/rsl.out.00 |        8.44070 |   149 |      0.05665 | 1270.98463 |      12.18773 |      6.09387 | 24x24 |  576 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T2-N032/rsl.out.00 |        4.69174 |   149 |      0.03149 | 2286.57172 |      12.15569 |      6.07784 | 32x36 | 1152 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T2-N064/rsl.out.00 |        3.22939 |   149 |      0.02167 | 3321.98960 |      14.22543 |      7.11272 | 48x48 | 2304 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T2-N128/rsl.out.00 |        2.15186 |   149 |      0.01444 | 4985.45444 |      12.66786 |      6.33393 | 64x72 | 4608 |
| conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T2-N256/rsl.out.00 |        1.56549 |   149 |      0.01051 | 6852.80647 |      14.27431 |      7.13715 | 96x96 | 9216 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T1-N001 |      161.50068 |   149 |      1.08390 |   66.42696 |      13.01239 |      6.50619 |   6x6 |   36 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T1-N002 |       85.83784 |   149 |      0.57609 |  124.97985 |      13.22285 |      6.61142 |   8x9 |   72 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T1-N004 |       43.80272 |   149 |      0.29398 |  244.91630 |      17.18948 |      8.59474 | 12x12 |  144 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T1-N008 |       20.89827 |   149 |      0.14026 |  513.34393 |      20.27428 |     10.13714 | 16x18 |  288 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T1-N016 |       10.87712 |   149 |      0.07300 |  986.29049 |      26.10210 |     13.05105 | 24x24 |  576 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T1-N032 |        5.93415 |   149 |      0.03983 | 1807.84106 |      75.27093 |     37.63546 | 32x36 | 1152 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T1-N064 |        4.02350 |   149 |      0.02700 | 2666.33528 |     339.89275 |    169.94638 | 48x48 | 2304 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T2-N001 |      157.71430 |   149 |      1.05849 |   68.02173 |      12.63764 |      6.31882 |   6x6 |   36 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T2-N002 |       76.68678 |   149 |      0.51468 |  139.89373 |      12.67668 |      6.33834 |   8x9 |   72 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T2-N004 |       44.31821 |   149 |      0.29744 |  242.06754 |      13.79229 |      6.89614 | 12x12 |  144 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T2-N008 |       21.81602 |   149 |      0.14642 |  491.74872 |      15.77773 |      7.88887 | 16x18 |  288 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T2-N016 |       11.09775 |   149 |      0.07448 |  966.68244 |      25.71347 |     12.85674 | 24x24 |  576 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T2-N032 |        5.81085 |   149 |      0.03900 | 1846.20150 |      71.40889 |     35.70444 | 32x36 | 1152 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2gnu7.1.0-T2-N064 |        3.91272 |   149 |      0.02626 | 2741.82666 |     350.20424 |    175.10212 | 48x48 | 2304 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T1-N001/rsl.out |      116.59193 |   149 |      0.78250 |   92.01323 |      12.73527 |      6.36763 |   6x6 |   36 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T1-N002/rsl.out |       58.99073 |   149 |      0.39591 |  181.85908 |      12.80697 |      6.40348 |   8x9 |   72 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T1-N004/rsl.out |       31.05322 |   149 |      0.20841 |  345.47142 |      13.75061 |      6.87531 | 12x12 |  144 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T1-N008/rsl.out |       15.65141 |   149 |      0.10504 |  685.43345 |      16.55407 |      8.27703 | 16x18 |  288 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T1-N016/rsl.out |        8.68723 |   149 |      0.05830 | 1234.91608 |      26.62334 |     13.31167 | 24x24 |  576 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T1-N032/rsl.out |        4.97045 |   149 |      0.03336 | 2158.35588 |      61.73998 |     30.86999 | 32x36 | 1152 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T1-N064/rsl.out |        3.22999 |   149 |      0.02168 | 3321.37251 |     316.97142 |    158.48571 | 48x48 | 2304 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T1-N128/rsl.out |        2.40573 |   149 |      0.01615 | 4459.35329 |     446.61813 |    446.61813 | 64x72 | 4608 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T1-N256/rsl.out |             -- |    -- |           -- |         -- |            -- |           -- | 96x96 | 9216 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T2-N001/rsl.out |      117.09013 |   149 |      0.78584 |   91.62173 |      12.70729 |      6.35365 |   6x6 |   36 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T2-N002/rsl.out |       58.88835 |   149 |      0.39522 |  182.17525 |      12.86810 |      6.43405 |   8x9 |   72 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T2-N004/rsl.out |       31.13682 |   149 |      0.20897 |  344.54386 |      14.50065 |      7.25033 | 12x12 |  144 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T2-N008/rsl.out |       15.69914 |   149 |      0.10536 |  683.34953 |      17.09288 |      8.54644 | 16x18 |  288 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T2-N016/rsl.out |        8.33983 |   149 |      0.05597 | 1286.35716 |      26.60487 |     13.30243 | 24x24 |  576 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T2-N032/rsl.out |        4.91646 |   149 |      0.03300 | 2182.05782 |      62.01196 |     31.00598 | 32x36 | 1152 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T2-N064/rsl.out |        3.06435 |   149 |      0.02057 | 3500.90558 |     334.25953 |    167.12976 | 48x48 | 2304 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T2-N128/rsl.out |        2.18053 |   149 |      0.01463 | 4919.90479 |     498.86386 |    498.86386 | 64x72 | 4608 |
| conus12km-WRFV3.8.1-gnu6.3.0-mvapich2.2-T2-N256/rsl.out |             -- |    -- |           -- |         -- |            -- |           -- | 96x96 | 9216 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T1-N001/rsl.out |       86.57501 |   149 |      0.58104 |  123.91567 |      11.61016 |      5.80508 |   6x6 |   36 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T1-N002/rsl.out |       42.85328 |   149 |      0.28761 |  250.34256 |      11.68894 |      5.84447 |   8x9 |   72 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T1-N004/rsl.out |       21.26974 |   149 |      0.14275 |  504.37852 |      12.37127 |      6.18563 | 12x12 |  144 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T1-N008/rsl.out |       10.91678 |   149 |      0.07327 |  982.70736 |      12.64363 |      6.32181 | 16x18 |  288 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T1-N016/rsl.out |        6.02415 |   149 |      0.04043 | 1780.83215 |      13.04767 |      6.52384 | 24x24 |  576 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T1-N032/rsl.out |        3.74614 |   149 |      0.02514 | 2863.74775 |      13.20536 |      6.60268 | 32x36 | 1152 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T1-N064/rsl.out |        2.46127 |   149 |      0.01652 | 4358.72537 |      12.95793 |      6.47896 | 48x48 | 2304 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T2-N001/rsl.out |       87.12675 |   149 |      0.58474 |  123.13096 |      11.66714 |      5.83357 |   6x6 |   36 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T2-N002/rsl.out |       42.49758 |   149 |      0.28522 |  252.43790 |      11.44606 |      5.72303 |   8x9 |   72 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T2-N004/rsl.out |       20.99630 |   149 |      0.14091 |  510.94717 |      11.65413 |      5.82707 | 12x12 |  144 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T2-N008/rsl.out |       10.51827 |   149 |      0.07059 | 1019.93959 |      11.77526 |      5.88763 | 16x18 |  288 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T2-N016/rsl.out |        5.82774 |   149 |      0.03911 | 1840.85083 |      12.12312 |      6.06156 | 24x24 |  576 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T2-N032/rsl.out |        3.63714 |   149 |      0.02441 | 2949.57027 |      12.26838 |      6.13419 | 32x36 | 1152 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T2-N064/rsl.out |        2.59566 |   149 |      0.01742 | 4133.05287 |      14.11697 |      7.05849 | 48x48 | 2304 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T2-N128/rsl.out |        1.90839 |   149 |      0.01281 | 5621.49246 |      12.89086 |      6.44543 | 64x72 | 4608 |
| conus12km-WRFV3.8.1-intel18.0.1-mpt2.18-T2-N256/rsl.out |        1.39718 |   149 |      0.00938 | 7678.32348 |      14.10451 |      7.05226 | 96x96 | 9216 |

#+NAME: table-splits
| Name Start Index | Name End Index | Table Start Index | Table End Index |
|------------------+----------------+-------------------+-----------------|
|               20 |             39 |                 0 |               9 |
|               20 |             39 |                 9 |              18 |
|               20 |             50 |                18 |              25 |
|               20 |             50 |                25 |              32 |
|               20 |             42 |                32 |              40 |
|               20 |             42 |                41 |              49 |
|               20 |             42 |                50 |              57 |
|               20 |             42 |                57 |              66 |

#+HEADER: :var data=wrf-stats meta=table-splits e_we=425 e_sn=300
#+BEGIN_SRC ipython :session :exports both :results raw drawer
for i in range(len(meta)):
    this_data = data[meta[i][2]:meta[i][3]]
    sec_step = np.array([d[3] for d in this_data])
    cpus = np.array([d[8] for d in this_data])
    gridpoints = e_we * e_sn
    plt.loglog(gridpoints/cpus, 1/sec_step, '+--',
               label=data[meta[i][2]][0][meta[i][0]:meta[i][1]])
plt.xlabel("Total grid points / core")
plt.ylabel("Time steps / s")
plt.legend(loc='upper center', bbox_to_anchor=(1.35, 0.8), ncol=1)
#plt.legend(loc='upper center', bbox_to_anchor=(0.5, -0.05), ncol=2)

plt.title("Scaling results for CONUS 12km with WRFV3.8.1")
plt.grid(False)
#+END_SRC

#+RESULTS:
:RESULTS:
# Out[69]:
[[file:./obipy-resources/28gTT0.svg]]
:END:
