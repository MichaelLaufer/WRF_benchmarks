#+TITLE: WRF scaling and timing on Cheyenne
#+AUTHOR: Akira Kyle
#+EMAIL: akyle@cmu.edu
#+OPTIONS: toc:nil email:t

* Code Snippets
  :PROPERTIES:
  :header-args: :results silent :exports code
  :END:

#+begin_src ipython :session
import numpy as np
import matplotlib.pyplot as plt
%matplotlib inline
%config InlineBackend.figure_format = 'svg'
#+end_src

#+begin_src ipython :session
def plot_it(cases, labels, title):
    for case,label in zip(cases,labels):
        runs = getFromDict(data, case)
        sec_step = np.array([d[2] for _,d in runs.items() if d[2] != '--'])
        cpus = np.array([d[7] for _,d in runs.items() if d[2] != '--'])
        gridpoints = e_we[case[0]] * e_sn[case[0]]
        plt.loglog(gridpoints/cpus, 1/sec_step, '+--', label=label[0])
    plt.xlabel("Total grid points / core")
    plt.ylabel("Time steps / s")
    plt.legend(loc='upper center', bbox_to_anchor=(1.35, 0.8), ncol=1)
    #plt.legend(loc='upper center', bbox_to_anchor=(0.5, -0.05), ncol=2)
    plt.title(title)
    plt.grid(False)
#+end_src

#+begin_src ipython :session :var raw_data=data raw_gridpoints=gridpoints
from collections import defaultdict
from functools import reduce
from operator import getitem

def getFromDict(dataDict, mapList): return reduce(getitem, mapList, dataDict)
tree = lambda: defaultdict(tree)

data = tree()
for run in raw_data:
    keys = run[0].split('/')[1:]
    keys[-1] = int(keys[-1][1:-4])
    keys[-2] = int(keys[-2][1:])
    d = getFromDict(data,keys[:-1])
    d[keys[-1]] = run[1:]

e_we = {}
e_sn = {}
for case in raw_gridpoints:
    e_we[case[0]] = case[1]
    e_sn[case[0]] = case[2]
#+end_src

* Data

#+name: gridpoints
| case           | e_we | e_sn |
|----------------+------+------|
| conus12km      |  425 |  300 |
| new_conus12km  |  425 |  300 |
| new_conus2.5km | 1901 | 1301 |
| maria3km       |  980 |  700 |

#+begin_src bash :dir /ssh:cheyenne:~/work/results :exports both :results raw drawer
echo "#+NAME: data"
wrf_stats $(find . -name *.rsl | sort)
#+end_src

#+RESULTS:
:RESULTS:
#+NAME: data
|                                                             File | Comp: Total(s) | Steps |   Avg.(s/step) |  I/O: Total(s) |   Avg.(s/step) |   X |   Y |  CPUs |
|------------------------------------------------------------------+----------------+-------+----------------+----------------+----------------+-----+-----+-------|
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N001.rsl |     116.217250 |   149 |     0.77998154 |       9.988910 |     4.99445500 |   6 |   6 |    36 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N002.rsl |      58.237550 |   149 |     0.39085604 |      10.157770 |     5.07888500 |   8 |   9 |    72 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N004.rsl |      30.409250 |   149 |     0.20408893 |      11.435220 |     5.71761000 |  12 |  12 |   144 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N008.rsl |      15.258410 |   149 |     0.10240544 |      11.965310 |     5.98265500 |  16 |  18 |   288 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N016.rsl |       8.557770 |   149 |     0.05743470 |      12.261900 |     6.13095000 |  24 |  24 |   576 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N032.rsl |       4.970610 |   149 |     0.03335980 |      12.154010 |     6.07700500 |  32 |  36 |  1152 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N064.rsl |       3.255260 |   149 |     0.02184738 |      12.541580 |     6.27079000 |  48 |  48 |  2304 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N128.rsl |       2.188540 |   149 |     0.01468819 |      13.332440 |     6.66622000 |  64 |  72 |  4608 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N256.rsl |       1.776430 |   149 |     0.01192235 |      15.753930 |     7.87696500 |  96 |  96 |  9216 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T2/N001.rsl |     116.098520 |   149 |     0.77918470 |      10.056040 |     5.02802000 |   6 |   6 |    36 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T2/N002.rsl |      58.218060 |   149 |     0.39072523 |       9.927260 |     4.96363000 |   8 |   9 |    72 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T2/N004.rsl |      29.072310 |   149 |     0.19511617 |      11.486870 |     5.74343500 |  12 |  12 |   144 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T2/N008.rsl |      15.337970 |   149 |     0.10293940 |      12.031110 |     6.01555500 |  16 |  18 |   288 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T2/N016.rsl |       8.440700 |   149 |     0.05664899 |      12.187730 |     6.09386500 |  24 |  24 |   576 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T2/N032.rsl |       4.691740 |   149 |     0.03148819 |      12.155690 |     6.07784500 |  32 |  36 |  1152 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T2/N064.rsl |       3.229390 |   149 |     0.02167376 |      14.225430 |     7.11271500 |  48 |  48 |  2304 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T2/N128.rsl |       2.151860 |   149 |     0.01444201 |      12.667860 |     6.33393000 |  64 |  72 |  4608 |
|               ./conus12km/WRFV3.8.1/gnu6.3.0/mpt2.18/T2/N256.rsl |       1.565490 |   149 |     0.01050664 |      14.274310 |     7.13715500 |  96 |  96 |  9216 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T1/N001.rsl |     161.500680 |   149 |     1.08389718 |      13.012390 |     6.50619500 |   6 |   6 |    36 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T1/N002.rsl |      85.837840 |   149 |     0.57609289 |      13.222850 |     6.61142500 |   8 |   9 |    72 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T1/N004.rsl |      43.802720 |   149 |     0.29397799 |      17.189480 |     8.59474000 |  12 |  12 |   144 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T1/N008.rsl |      20.898270 |   149 |     0.14025685 |      20.274280 |    10.13714000 |  16 |  18 |   288 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T1/N016.rsl |      10.877120 |   149 |     0.07300081 |      26.102100 |    13.05105000 |  24 |  24 |   576 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T1/N032.rsl |       5.934150 |   149 |     0.03982651 |      75.270930 |    37.63546500 |  32 |  36 |  1152 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T1/N064.rsl |       4.023500 |   149 |     0.02700336 |     339.892750 |   169.94637500 |  48 |  48 |  2304 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T2/N001.rsl |     157.714300 |   149 |     1.05848523 |      12.637640 |     6.31882000 |   6 |   6 |    36 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T2/N002.rsl |      76.686780 |   149 |     0.51467638 |      12.676680 |     6.33834000 |   8 |   9 |    72 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T2/N004.rsl |      44.318210 |   149 |     0.29743765 |      13.792290 |     6.89614500 |  12 |  12 |   144 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T2/N008.rsl |      21.816020 |   149 |     0.14641624 |      15.777730 |     7.88886500 |  16 |  18 |   288 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T2/N016.rsl |      11.097750 |   149 |     0.07448154 |      25.713470 |    12.85673500 |  24 |  24 |   576 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T2/N032.rsl |       5.810850 |   149 |     0.03899899 |      71.408890 |    35.70444500 |  32 |  36 |  1152 |
|    ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2gnu7.1.0/T2/N064.rsl |       3.912720 |   149 |     0.02625987 |     350.204240 |   175.10212000 |  48 |  48 |  2304 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N001.rsl |     116.591930 |   149 |     0.78249617 |      12.735270 |     6.36763500 |   6 |   6 |    36 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N002.rsl |      58.990730 |   149 |     0.39591094 |      12.806970 |     6.40348500 |   8 |   9 |    72 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N004.rsl |      31.053220 |   149 |     0.20841087 |      13.750610 |     6.87530500 |  12 |  12 |   144 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N008.rsl |      15.651410 |   149 |     0.10504302 |      16.554070 |     8.27703500 |  16 |  18 |   288 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N016.rsl |       8.687230 |   149 |     0.05830356 |      26.623340 |    13.31167000 |  24 |  24 |   576 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N032.rsl |       4.970450 |   149 |     0.03335872 |      61.739980 |    30.86999000 |  32 |  36 |  1152 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N064.rsl |       3.229990 |   149 |     0.02167779 |     316.971420 |   158.48571000 |  48 |  48 |  2304 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N128.rsl |       2.405730 |   149 |     0.01614584 |     446.618130 |   446.61813000 |  64 |  72 |  4608 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N256.rsl |             -- |    -- |             -- |             -- |             -- |  96 |  96 |  9216 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T2/N001.rsl |     117.090130 |   149 |     0.78583980 |      12.707290 |     6.35364500 |   6 |   6 |    36 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T2/N002.rsl |      58.888350 |   149 |     0.39522383 |      12.868100 |     6.43405000 |   8 |   9 |    72 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T2/N004.rsl |      31.136820 |   149 |     0.20897195 |      14.500650 |     7.25032500 |  12 |  12 |   144 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T2/N008.rsl |      15.699140 |   149 |     0.10536336 |      17.092880 |     8.54644000 |  16 |  18 |   288 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T2/N016.rsl |       8.339830 |   149 |     0.05597201 |      26.604870 |    13.30243500 |  24 |  24 |   576 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T2/N032.rsl |       4.916460 |   149 |     0.03299638 |      62.011960 |    31.00598000 |  32 |  36 |  1152 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T2/N064.rsl |       3.064350 |   149 |     0.02056611 |     334.259530 |   167.12976500 |  48 |  48 |  2304 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T2/N128.rsl |       2.180530 |   149 |     0.01463443 |     498.863860 |   498.86386000 |  64 |  72 |  4608 |
|            ./conus12km/WRFV3.8.1/gnu6.3.0/mvapich2.2/T2/N256.rsl |             -- |    -- |             -- |             -- |             -- |  96 |  96 |  9216 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N001.rsl |      86.575010 |   149 |     0.58104034 |      11.610160 |     5.80508000 |   6 |   6 |    36 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N002.rsl |      42.853280 |   149 |     0.28760591 |      11.688940 |     5.84447000 |   8 |   9 |    72 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N004.rsl |      21.269740 |   149 |     0.14274993 |      12.371270 |     6.18563500 |  12 |  12 |   144 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N008.rsl |      10.916780 |   149 |     0.07326698 |      12.643630 |     6.32181500 |  16 |  18 |   288 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N016.rsl |       6.024150 |   149 |     0.04043054 |      13.047670 |     6.52383500 |  24 |  24 |   576 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N032.rsl |       3.746140 |   149 |     0.02514188 |      13.205360 |     6.60268000 |  32 |  36 |  1152 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N064.rsl |       2.461270 |   149 |     0.01651859 |      12.957930 |     6.47896500 |  48 |  48 |  2304 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T2/N001.rsl |      87.126750 |   149 |     0.58474329 |      11.667140 |     5.83357000 |   6 |   6 |    36 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T2/N002.rsl |      42.497580 |   149 |     0.28521866 |      11.446060 |     5.72303000 |   8 |   9 |    72 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T2/N004.rsl |      20.996300 |   149 |     0.14091477 |      11.654130 |     5.82706500 |  12 |  12 |   144 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T2/N008.rsl |      10.518270 |   149 |     0.07059242 |      11.775260 |     5.88763000 |  16 |  18 |   288 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T2/N016.rsl |       5.827740 |   149 |     0.03911235 |      12.123120 |     6.06156000 |  24 |  24 |   576 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T2/N032.rsl |       3.637140 |   149 |     0.02441034 |      12.268380 |     6.13419000 |  32 |  36 |  1152 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T2/N064.rsl |       2.595660 |   149 |     0.01742054 |      14.116970 |     7.05848500 |  48 |  48 |  2304 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T2/N128.rsl |       1.908390 |   149 |     0.01280799 |      12.890860 |     6.44543000 |  64 |  72 |  4608 |
|            ./conus12km/WRFV3.8.1/intel18.0.1/mpt2.18/T2/N256.rsl |       1.397180 |   149 |     0.00937705 |      14.104510 |     7.05225500 |  96 |  96 |  9216 |
|               ./maria3km/WRFV4.0/gnu6.3.0/mvapich2.2/T1/N002.rsl |    8191.478350 |  1196 |     6.84906217 |     725.142190 |   181.28554750 |   8 |   9 |    72 |
|               ./maria3km/WRFV4.0/gnu6.3.0/mvapich2.2/T1/N004.rsl |    4199.618470 |  1196 |     3.51138668 |     722.248630 |   180.56215750 |  12 |  12 |   144 |
|               ./maria3km/WRFV4.0/gnu6.3.0/mvapich2.2/T1/N008.rsl |    2077.701230 |  1196 |     1.73720839 |     711.335560 |   177.83389000 |  16 |  18 |   288 |
|               ./maria3km/WRFV4.0/gnu6.3.0/mvapich2.2/T1/N016.rsl |    1106.726200 |  1196 |     0.92535635 |     728.335440 |   182.08386000 |  24 |  24 |   576 |
|               ./maria3km/WRFV4.0/gnu6.3.0/mvapich2.2/T1/N032.rsl |     554.367810 |  1196 |     0.46351824 |     771.545770 |   192.88644250 |  32 |  36 |  1152 |
|               ./maria3km/WRFV4.0/gnu6.3.0/mvapich2.2/T1/N064.rsl |     285.521740 |  1196 |     0.23873055 |    1265.416910 |   316.35422750 |  48 |  48 |  2304 |
|                  ./maria3km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N002.rsl |    8048.250800 |  1196 |     6.72930669 |    1370.973830 |   342.74345750 |   8 |   9 |    72 |
|                  ./maria3km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N008.rsl |    2114.725620 |  1196 |     1.76816523 |    1373.083970 |   343.27099250 |  16 |  18 |   288 |
|                  ./maria3km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N016.rsl |    1091.699340 |  1196 |     0.91279209 |    1371.219960 |   342.80499000 |  24 |  24 |   576 |
|                  ./maria3km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N032.rsl |     551.934410 |  1196 |     0.46148362 |    1366.829820 |   341.70745500 |  32 |  36 |  1152 |
|                  ./maria3km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N064.rsl |     284.399280 |  1196 |     0.23779204 |    1378.730180 |   344.68254500 |  48 |  48 |  2304 |
|               ./maria3km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N002.rsl |    8092.983720 |  1196 |     6.76670880 |    1438.384560 |   359.59614000 |   8 |   9 |    72 |
|               ./maria3km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N008.rsl |    2112.657080 |  1196 |     1.76643569 |    1423.426900 |   355.85672500 |  16 |  18 |   288 |
|               ./maria3km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N016.rsl |    1090.997970 |  1196 |     0.91220566 |    1439.324350 |   359.83108750 |  24 |  24 |   576 |
|               ./maria3km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N032.rsl |     551.682410 |  1196 |     0.46127292 |    1497.353940 |   374.33848500 |  32 |  36 |  1152 |
|        ./maria3km/WRFV4.0/gnu8.1.0-O3-fma/mvapich2.2/T1/N002.rsl |    8241.118060 |  1196 |     6.89056694 |    1481.944860 |   370.48621500 |   8 |   9 |    72 |
|        ./maria3km/WRFV4.0/gnu8.1.0-O3-fma/mvapich2.2/T1/N004.rsl |    4266.056660 |  1196 |     3.56693701 |    1481.126490 |   370.28162250 |  12 |  12 |   144 |
|        ./maria3km/WRFV4.0/gnu8.1.0-O3-fma/mvapich2.2/T1/N008.rsl |    2201.458660 |  1196 |     1.84068450 |    1472.536250 |   368.13406250 |  16 |  18 |   288 |
|        ./maria3km/WRFV4.0/gnu8.1.0-O3-fma/mvapich2.2/T1/N016.rsl |    1146.201650 |  1196 |     0.95836258 |    1492.881760 |   373.22044000 |  24 |  24 |   576 |
|        ./maria3km/WRFV4.0/gnu8.1.0-O3-fma/mvapich2.2/T1/N032.rsl |     582.265230 |  1196 |     0.48684384 |    1542.042850 |   385.51071250 |  32 |  36 |  1152 |
|         ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N001.rsl |     347.583730 |   297 |     1.17031559 |      15.297510 |     2.18535857 |   6 |   6 |    36 |
|         ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N002.rsl |     179.693520 |   297 |     0.60502869 |      15.297500 |     2.18535714 |   8 |   9 |    72 |
|         ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N004.rsl |      92.748640 |   297 |     0.31228498 |      17.647930 |     2.52113286 |  12 |  12 |   144 |
|         ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N008.rsl |      49.886830 |   297 |     0.16796912 |      20.163700 |     2.88052857 |  16 |  18 |   288 |
|         ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N016.rsl |      26.962670 |   297 |     0.09078340 |      21.282050 |     3.04029286 |  24 |  24 |   576 |
|         ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N032.rsl |      13.914550 |   297 |     0.04685034 |      18.169640 |     2.59566286 |  32 |  36 |  1152 |
|         ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mpt2.18/T1/N064.rsl |       9.551130 |   297 |     0.03215869 |      22.576020 |     3.22514571 |  48 |  48 |  2304 |
|      ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N001.rsl |     349.936820 |   297 |     1.17823845 |      17.290070 |     2.47001000 |   6 |   6 |    36 |
|      ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N002.rsl |     179.238680 |   297 |     0.60349724 |      19.160300 |     2.73718571 |   8 |   9 |    72 |
|      ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N004.rsl |      93.226360 |   297 |     0.31389347 |      20.579410 |     2.93991571 |  12 |  12 |   144 |
|      ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N016.rsl |      25.558570 |   297 |     0.08605579 |      39.008200 |     5.57260000 |  24 |  24 |   576 |
|      ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N032.rsl |      14.305220 |   297 |     0.04816572 |      98.436840 |    14.06240571 |  32 |  36 |  1152 |
|      ./new_conus12km_3/WRFV3.8.1/gnu6.3.0/mvapich2.2/T1/N064.rsl |       8.720190 |   297 |     0.02936091 |     661.464170 |    94.49488143 |  48 |  48 |  2304 |
|      ./new_conus12km_3/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N001.rsl |     247.580220 |   297 |     0.83360343 |      16.783230 |     2.39760429 |   6 |   6 |    36 |
|      ./new_conus12km_3/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N002.rsl |     115.034230 |   297 |     0.38732064 |      16.387200 |     2.34102857 |   8 |   9 |    72 |
|      ./new_conus12km_3/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N004.rsl |      58.064320 |   297 |     0.19550276 |      17.193420 |     2.45620286 |  12 |  12 |   144 |
|      ./new_conus12km_3/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N008.rsl |      31.645480 |   297 |     0.10655044 |      18.894930 |     2.69927571 |  16 |  18 |   288 |
|      ./new_conus12km_3/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N016.rsl |      18.257290 |   297 |     0.06147236 |      19.915010 |     2.84500143 |  24 |  24 |   576 |
|      ./new_conus12km_3/WRFV3.8.1/intel18.0.1/mpt2.18/T1/N032.rsl |      10.970310 |   297 |     0.03693707 |      21.131570 |     3.01879571 |  32 |  36 |  1152 |
|             ./new_conus12km/WRFV4.0/gnu6.3.0/mpt2.18/T1/N001.rsl |     357.004590 |   298 |     1.19800198 |      52.562400 |     7.50891429 |   6 |   6 |    36 |
|             ./new_conus12km/WRFV4.0/gnu6.3.0/mpt2.18/T1/N002.rsl |     181.709730 |   298 |     0.60976419 |      53.215820 |     7.60226000 |   8 |   9 |    72 |
|             ./new_conus12km/WRFV4.0/gnu6.3.0/mpt2.18/T1/N004.rsl |      94.647360 |   298 |     0.31760859 |      52.765270 |     7.53789571 |  12 |  12 |   144 |
|             ./new_conus12km/WRFV4.0/gnu6.3.0/mpt2.18/T1/N008.rsl |      48.056470 |   298 |     0.16126332 |      53.131710 |     7.59024429 |  16 |  18 |   288 |
|             ./new_conus12km/WRFV4.0/gnu6.3.0/mpt2.18/T1/N016.rsl |      26.160130 |   298 |     0.08778567 |      53.557440 |     7.65106286 |  24 |  24 |   576 |
|      ./new_conus12km/WRFV4.0/gnu8.1.0/fma/mvapich2.2/T1/N001.rsl |     366.224560 |   298 |     1.22894148 |     117.459470 |    16.77992429 |   6 |   6 |    36 |
|      ./new_conus12km/WRFV4.0/gnu8.1.0/fma/mvapich2.2/T1/N002.rsl |     186.787490 |   298 |     0.62680366 |     118.718250 |    16.95975000 |   8 |   9 |    72 |
|      ./new_conus12km/WRFV4.0/gnu8.1.0/fma/mvapich2.2/T1/N004.rsl |      98.071410 |   298 |     0.32909869 |     121.681200 |    17.38302857 |  12 |  12 |   144 |
|      ./new_conus12km/WRFV4.0/gnu8.1.0/fma/mvapich2.2/T1/N008.rsl |      49.876500 |   298 |     0.16737081 |     126.838320 |    18.11976000 |  16 |  18 |   288 |
|      ./new_conus12km/WRFV4.0/gnu8.1.0/fma/mvapich2.2/T1/N016.rsl |      27.389110 |   298 |     0.09190977 |     141.880600 |    20.26865714 |  24 |  24 |   576 |
|             ./new_conus12km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N001.rsl |     353.859100 |   298 |     1.18744664 |     112.486400 |    16.06948571 |   6 |   6 |    36 |
|             ./new_conus12km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N002.rsl |     180.968820 |   298 |     0.60727792 |     116.434450 |    16.63349286 |   8 |   9 |    72 |
|             ./new_conus12km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N004.rsl |      95.125170 |   298 |     0.31921198 |     115.640630 |    16.52009000 |  12 |  12 |   144 |
|             ./new_conus12km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N016.rsl |      25.723870 |   298 |     0.08632171 |     121.450400 |    17.35005714 |  24 |  24 |   576 |
|          ./new_conus12km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N001.rsl |     356.558140 |   298 |     1.19650383 |     117.778110 |    16.82544429 |   6 |   6 |    36 |
|          ./new_conus12km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N002.rsl |     181.568050 |   298 |     0.60928876 |     118.036090 |    16.86229857 |   8 |   9 |    72 |
|          ./new_conus12km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N004.rsl |      95.182500 |   298 |     0.31940436 |     120.632860 |    17.23326571 |  12 |  12 |   144 |
|          ./new_conus12km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N008.rsl |      48.415840 |   298 |     0.16246926 |     126.009490 |    18.00135571 |  16 |  18 |   288 |
|          ./new_conus12km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N016.rsl |      26.364350 |   298 |     0.08847097 |     141.820520 |    20.26007429 |  24 |  24 |   576 |
|   ./new_conus12km/WRFV4.0/gnu8.1.0/O3/fma/mvapich2.2/T1/N001.rsl |     362.081820 |   298 |     1.21503966 |     119.516410 |    17.07377286 |   6 |   6 |    36 |
|   ./new_conus12km/WRFV4.0/gnu8.1.0/O3/fma/mvapich2.2/T1/N002.rsl |     186.113760 |   298 |     0.62454282 |     121.286900 |    17.32670000 |   8 |   9 |    72 |
|   ./new_conus12km/WRFV4.0/gnu8.1.0/O3/fma/mvapich2.2/T1/N004.rsl |      98.722820 |   298 |     0.33128463 |     124.096070 |    17.72801000 |  12 |  12 |   144 |
|   ./new_conus12km/WRFV4.0/gnu8.1.0/O3/fma/mvapich2.2/T1/N008.rsl |      49.770570 |   298 |     0.16701534 |     130.820890 |    18.68869857 |  16 |  18 |   288 |
|       ./new_conus12km/WRFV4.0/gnu8.1.0/O3/mvapich2.2/T1/N001.rsl |     353.965790 |   298 |     1.18780466 |     118.164330 |    16.88061857 |   6 |   6 |    36 |
|       ./new_conus12km/WRFV4.0/gnu8.1.0/O3/mvapich2.2/T1/N002.rsl |     181.259370 |   298 |     0.60825292 |     119.502970 |    17.07185286 |   8 |   9 |    72 |
|       ./new_conus12km/WRFV4.0/gnu8.1.0/O3/mvapich2.2/T1/N004.rsl |      95.662510 |   298 |     0.32101513 |     122.476070 |    17.49658143 |  12 |  12 |   144 |
|       ./new_conus12km/WRFV4.0/gnu8.1.0/O3/mvapich2.2/T1/N008.rsl |      48.040490 |   298 |     0.16120970 |     127.406270 |    18.20089571 |  16 |  18 |   288 |
|       ./new_conus12km/WRFV4.0/gnu8.1.0/O3/mvapich2.2/T1/N016.rsl |      26.157140 |   298 |     0.08777564 |     144.777570 |    20.68251000 |  24 |  24 |   576 |
|          ./new_conus12km/WRFV4.0/intel18.0.1/mpt2.18/T1/N001.rsl |     256.937610 |   298 |     0.86220674 |      46.611320 |     6.65876000 |   6 |   6 |    36 |
|          ./new_conus12km/WRFV4.0/intel18.0.1/mpt2.18/T1/N002.rsl |     127.528500 |   298 |     0.42794799 |      47.085550 |     6.72650714 |   8 |   9 |    72 |
|          ./new_conus12km/WRFV4.0/intel18.0.1/mpt2.18/T1/N004.rsl |      63.817690 |   298 |     0.21415332 |      48.255210 |     6.89360143 |  12 |  12 |   144 |
|          ./new_conus12km/WRFV4.0/intel18.0.1/mpt2.18/T1/N008.rsl |      32.045950 |   298 |     0.10753674 |      49.444690 |     7.06352714 |  16 |  18 |   288 |
|          ./new_conus12km/WRFV4.0/intel18.0.1/mpt2.18/T1/N016.rsl |      17.861060 |   298 |     0.05993644 |      51.299700 |     7.32852857 |  24 |  24 |   576 |
|          ./new_conus12km/WRFV4.0/intel18.0.1/mpt2.18/T2/N001.rsl |     255.411920 |   298 |     0.85708698 |      46.610440 |     6.65863429 |   6 |   6 |    36 |
|          ./new_conus12km/WRFV4.0/intel18.0.1/mpt2.18/T2/N002.rsl |     128.371850 |   298 |     0.43077802 |      52.037910 |     7.43398714 |   8 |   9 |    72 |
|          ./new_conus12km/WRFV4.0/intel18.0.1/mpt2.18/T2/N004.rsl |      63.508440 |   298 |     0.21311557 |      49.520300 |     7.07432857 |  12 |  12 |   144 |
|          ./new_conus12km/WRFV4.0/intel18.0.1/mpt2.18/T2/N008.rsl |      31.749330 |   298 |     0.10654138 |      49.083760 |     7.01196571 |  16 |  18 |   288 |
|          ./new_conus12km/WRFV4.0/intel18.0.1/mpt2.18/T2/N016.rsl |      16.451850 |   298 |     0.05520755 |      50.915010 |     7.27357286 |  24 |  24 |   576 |
|         ./new_conus2.5km/WRFV4.0/gnu6.3.0/mvapich2.2/T1/N004.rsl |    8054.721880 |  1438 |     5.60133650 |    1078.572920 |   269.64323000 |  12 |  12 |   144 |
|         ./new_conus2.5km/WRFV4.0/gnu6.3.0/mvapich2.2/T1/N008.rsl |    4087.881740 |  1438 |     2.84275503 |    1055.861770 |   263.96544250 |  16 |  18 |   288 |
|         ./new_conus2.5km/WRFV4.0/gnu6.3.0/mvapich2.2/T1/N064.rsl |     563.656460 |  1438 |     0.39197250 |    1567.982240 |   391.99556000 |  48 |  48 |  2304 |
|            ./new_conus2.5km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N004.rsl |    7904.133680 |  1438 |     5.49661591 |    2008.498490 |   502.12462250 |  12 |  12 |   144 |
|            ./new_conus2.5km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N016.rsl |    2105.931980 |  1438 |     1.46448677 |    2010.362620 |   502.59065500 |  24 |  24 |   576 |
|            ./new_conus2.5km/WRFV4.0/gnu8.1.0/mpt2.18/T1/N032.rsl |    1034.885840 |  1438 |     0.71967026 |    2002.025540 |   500.50638500 |  32 |  36 |  1152 |
|         ./new_conus2.5km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N004.rsl |    7991.761460 |  1438 |     5.55755317 |    2127.243960 |   531.81099000 |  12 |  12 |   144 |
|         ./new_conus2.5km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N016.rsl |    2106.803390 |  1438 |     1.46509276 |    2118.999390 |   529.74984750 |  24 |  24 |   576 |
|         ./new_conus2.5km/WRFV4.0/gnu8.1.0/mvapich2.2/T1/N064.rsl |     539.091420 |  1438 |     0.37488972 |    2630.282410 |   657.57060250 |  48 |  48 |  2304 |
|  ./new_conus2.5km/WRFV4.0/gnu8.1.0-O3-fma/mvapich2.2/T1/N016.rsl |    2169.773380 |  1438 |     1.50888274 |    2191.005930 |   547.75148250 |  24 |  24 |   576 |
:END:

* CONUS 12km

#+begin_src sh
wrf_run_pbs_jobs \
    --wrfs ~/work/WRFs/WRFV3.8.1-gnu6.3.0-mpt2.18 \
    --cases ~/WRF_benchmarks/cases/conus12km \
    -n 1 2 4 8 16 32 64 128 256 -t 1
wrf_summarize_runs -r conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N* \
                   -o conus12km-WRFV3.8.1/gnu6.3.0/mpt2.18/T1 -t
#+end_src

#+name: conus12km-cases
| case      | WRF version | compiler    | mpi                | trial |
|-----------+-------------+-------------+--------------------+-------|
| conus12km | WRFV3.8.1   | gnu6.3.0    | mpt2.18            |     1 |
| conus12km | WRFV3.8.1   | gnu6.3.0    | mpt2.18            |     2 |
| conus12km | WRFV3.8.1   | gnu6.3.0    | mvapich2.2         |     1 |
| conus12km | WRFV3.8.1   | gnu6.3.0    | mvapich2.2         |     2 |
| conus12km | WRFV3.8.1   | gnu6.3.0    | mvapich2.2gnu7.1.0 |     1 |
| conus12km | WRFV3.8.1   | gnu6.3.0    | mvapich2.2gnu7.1.0 |     2 |
| conus12km | WRFV3.8.1   | intel18.0.1 | mpt2.18            |     1 |
| conus12km | WRFV3.8.1   | intel18.0.1 | mpt2.18            |     2 |

#+name: conus12km-labels
| label                          |
|--------------------------------|
| gnu6.3.0/mpt2.18/T1            |
| gnu6.3.0/mpt2.18/T2            |
| gnu6.3.0/mvapich2.2/T1         |
| gnu6.3.0/mvapich2.2/T2         |
| gnu6.3.0/mvapich2.2gnu7.1.0/T1 |
| gnu6.3.0/mvapich2.2gnu7.1.0/T2 |
| intel18.0.1/mpt2.18/T1         |
| intel18.0.1/mpt2.18/T2         |

#+header: :var cases=conus12km-cases labels=conus12km-labels
#+header: :var title="Scaling results for CONUS 12km with WRFV3.8.1"
#+begin_src ipython :session :results raw drawer
plot_it(cases, labels, title)
#+end_src

#+RESULTS:
:RESULTS:
# Out[6]:
[[file:./obipy-resources/tpLgRY.svg]]
:END:

* NEW CONUS 12km
#+begin_src sh
wrf_run_pbs_jobs \
    --wrfs \
    ~/work/WRFs/WRFV4.0-gnu8.1.0-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-gnu8.1.0-fma-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-gnu8.1.0-O3-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-gnu8.1.0-O3-fma-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-intel17.0.1-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-intel18.0.1-mvapich2.2 \
    --cases ~/WRF_benchmarks/cases/new_conus12km \
    -n 1 2 4 8 16 -t 1

wrf_summarize_runs -r conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N* \
                   -o conus12km-WRFV3.8.1/gnu6.3.0/mpt2.18/T1 -t
#+end_src

#+name: new_conus12km-cases
| case          | WRF version | compiler    | mpi     | trial |
|---------------+-------------+-------------+---------+-------|
| new_conus12km | WRFV4.0     | gnu6.3.0    | mpt2.18 |     1 |
| new_conus12km | WRFV4.0     | intel18.0.1 | mpt2.18 |     1 |
| new_conus12km | WRFV4.0     | intel18.0.1 | mpt2.18 |     2 |

#+name: new_conus12km-labels
| label                  |
|------------------------|
| gnu6.3.0/mpt2.18/T1    |
| intel18.0.1/mpt2.18/T1 |
| intel18.0.1/mpt2.18/T2 |

#+header: :var cases=new_conus12km-cases labels=new_conus12km-labels
#+header: :var title="Scaling results for CONUS 12km with WRFV3.8.1"
#+begin_src ipython :session :results raw drawer
plot_it(cases, labels, title)
#+end_src

#+RESULTS:
:RESULTS:
# Out[9]:
[[file:./obipy-resources/xscKkU.svg]]
:END:

* NEW CONUS 2.5km

#+begin_src sh

wrf_run_pbs_jobs \
    --wrfs \
    ~/work/WRFs/WRFV4.0-gnu8.1.0-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-gnu8.1.0-fma-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-gnu8.1.0-O3-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-gnu8.1.0-O3-fma-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-intel17.0.1-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-intel18.0.1-mvapich2.2 \
    --cases ~/WRF_benchmarks/cases/new_conus12km \
    -n 1 2 4 8 16 -t 1


wrf_run_pbs_jobs \
    --wrfs \
    ~/work/WRFs/WRFV4.0-intel17.0.1-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-intel18.0.1-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-gnu6.3.0-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-gnu8.1.0-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-gnu8.1.0-O3-fma-mvapich2.2 \
    ~/work/WRFs/WRFV4.0-gnu8.1.0-mpt2.18 \
    --cases \
    ~/WRF_benchmarks/cases/new_conus2.5km \
    ~/WRF_benchmarks/cases/maria3km \
    ~/WRF_benchmarks/cases/maria1km \
    -n 1 2 4 8 16 32 64 128 256 -t 2 -a '04:00:00'

wrf_summarize_runs -r conus12km-WRFV3.8.1-gnu6.3.0-mpt2.18-T1-N* \
                   -o conus12km-WRFV3.8.1/gnu6.3.0/mpt2.18/T1 -t
#+end_src

* Cases

#+name: cases-cases
| case           | WRF version | compiler | mpi        | trial |
|----------------+-------------+----------+------------+-------|
| new_conus12km  | WRFV4.0     | gnu8.1.0 | mpt2.18    |     1 |
| new_conus12km  | WRFV4.0     | gnu8.1.0 | mvapich2.2 |     1 |
| new_conus2.5km | WRFV4.0     | gnu8.1.0 | mpt2.18    |     1 |
| new_conus2.5km | WRFV4.0     | gnu8.1.0 | mvapich2.2 |     1 |
| maria3km       | WRFV4.0     | gnu8.1.0 | mpt2.18    |     1 |
| maria3km       | WRFV4.0     | gnu8.1.0 | mvapich2.2 |     1 |

#+name: cases-labels
| label                     |
|---------------------------|
| new_conus12km/mpt2.18     |
| new_conus12km/mvapich2.2  |
| new_conus2.5km/mpt2.18    |
| new_conus2.5km/mvapich2.2 |
| maria3km/mpt2.18          |
| maria3km/mvapich2.2       |

#+header: :var cases=cases-cases labels=cases-labels
#+header: :var title="Scaling results for CONUS 12km with WRFV3.8.1"
#+begin_src ipython :session :results raw drawer
plot_it(cases, labels, title)
#+end_src

#+RESULTS:
:RESULTS:
# Out[12]:
[[file:./obipy-resources/WWJJaB.svg]]
:END:
